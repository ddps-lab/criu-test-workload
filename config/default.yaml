# CRIU Workload Experiment Configuration
# =========================================
# Default configuration for CRIU checkpoint/migration experiments

# Experiment metadata
experiment:
  name: "default-experiment"
  workload_type: "memory"
  description: "Default CRIU checkpoint experiment"
  save_metrics: true
  metrics_file: "experiment_metrics.json"

# Node configuration
# Edit these values directly for your environment
nodes:
  ssh_user: "ubuntu"
  ssh_key: "~/.ssh/id_ed25519"

  # Source node (where workload runs and checkpoint is taken)
  source:
    ip: "10.0.1.10"      # Edit: your source node IP
    name: "source-node"

  # Destination node (where workload is restored)
  destination:
    ip: "10.0.1.11"      # Edit: your destination node IP
    name: "dest-node"

# Checkpoint strategy configuration
checkpoint:
  # Directories
  dirs:
    working_dir: "/tmp/criu_checkpoint"

  # Strategy: 'predump' or 'full'
  strategy:
    mode: "predump"

    # Pre-dump configuration (only for mode: predump)
    predump_iterations: 8
    predump_interval: 10  # seconds between iterations
    sync_after_predump: false  # sync to EBS/EFS after each pre-dump

    # Lazy-pages configuration
    lazy_pages: false
    page_server_port: 22222

    # Full dump configuration (only for mode: full)
    wait_before_dump: 30  # seconds to wait before dump

# Transfer configuration
transfer:
  # Method: 'rsync', 's3', 'efs', 'ebs'
  method: "rsync"

  # Destination directory for rsync
  dest_dir: "/tmp/criu_checkpoint"

  # S3 configuration (for method: s3)
  # s3_bucket: "${AWS_S3_BUCKET}"
  # s3_prefix: "checkpoints"

  # EFS configuration (for method: efs)
  # efs_mount: "/mnt/efs"

  # EBS configuration (for method: ebs)
  # ebs_mount: "/mnt/ebs_test"

# Workload configuration
workload:
  # Common settings
  working_dir: "/tmp/criu_checkpoint"

  # Readiness check
  readiness:
    file_path: "checkpoint_ready"
    timeout: 300  # seconds to wait for workload to be ready

# Paths configuration
# These paths are on the WORKLOAD nodes (not control node)
paths:
  # Where workload scripts are deployed on workload nodes
  scripts_dir: "/tmp/criu_checkpoint"

  # Where workload data files are stored (for workloads that need input data)
  data_dir: "/tmp/criu_data"

  # Data setup options
  data_setup:
    # How to prepare data: 'generate', 'download', 'none'
    method: "generate"

    # For method: download
    # s3_bucket: "my-bucket"
    # s3_prefix: "workload-data"

    # For method: generate
    # Data is generated by the workload itself (e.g., testsrc for ffmpeg)

# Migration success criteria
migration:
  # What to measure
  metrics:
    - checkpoint_time      # Time to dump process
    - transfer_time        # Time to transfer checkpoint images
    - restore_time         # Time to restore process
    - total_downtime       # checkpoint_time + transfer_time + restore_time
    - data_integrity       # Verify data after restore (for redis, etc.)

  # Success conditions
  success_criteria:
    # Process must be running after restore
    process_running: true
    # Data integrity check must pass (for applicable workloads)
    data_integrity_check: true

# Logging configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
